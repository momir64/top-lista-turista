import{n as P}from"./AdminBar.dcdd954f.js";import{_ as L,f as N,h as x,V as f,j as p,i as R,k as I,b as w,ah as $,p as y}from"./VMain.1d14ca28.js";import{r as b,s as v,o as k,c as z,w as s,a,x as q,f as m,t as h,d as M,e as Y,F as G,n as H,v as D,y as C,b as g,p as J,g as K}from"./index.47f7c269.js";import{S as Z,V as Q}from"./index.94f23116.js";import{V as U,a as r,c as W,b as c}from"./VTextField.7f9fff51.js";import{V as X}from"./VFileInput.fd1250f2.js";import{V as ee,b as B,a as ae}from"./VList.033b98aa.js";import{V as T}from"./VHover.625f4f5e.js";import"./VChip.95086708.js";const te={components:{navigation:P,foote:N},data:()=>({url:"https://top-lista-turista-default-rtdb.europe-west1.firebasedatabase.app/",fab:null,dialog:!1,disabledBtn:!1,okDialog:!1,destinacijaBrisanje:null,destinacijaBrisanjeID:null,destinacijaBrisanjeIndex:null,agencijaMenjanjeID:null,agencijaMenjanjeIndex:null,agencija:{},destinacije:[],naziv:null,ulica:null,grad:null,postBroj:null,email:null,telefon:null,osnovana:null,slika:null,slikaURL:null,isFormValid:!1,required:[e=>!!e||"Obavezno polje"],numeric:[e=>/^\d+$/.test(e)||"Mora biti broj"],numericPhone:[e=>/^[\+]?[(]?[0-9]{3}[)]?[-\s\.\\/]?[0-9]{2,6}[-\s\.]?[0-9]{2,6}[-\s\.]?[0-9]{1,6}$/.test(e)||"Neispravan telefon"],numericYear:[e=>+e>=1923&&+e<=new Date().getFullYear()||"Neispravna godina"],emailCheck:[e=>/[^@ \t\r\n]+@[^@ \t\r\n]+\.[^@ \t\r\n]+/.test(e)||"Neispravan email"],nameCheck:[e=>/^[a-z0-9_-]{2,20}$/.test(e)||"Neispravano korisni\u010Dko ime"],passCheck:[e=>/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9]).{8,}$/.test(e)||"Nedovoljno jaka lozinka"]}),computed:{fileCheck(){return[e=>!!e&&!!e.length||"Obavezno polje",e=>!!e[0].size||e[0].name==this.agencija.slika||"Neispravan fajl",e=>e[0].name==this.agencija.slika||e[0].size<1e7||"Prevelika slika"]}},methods:{async brisanjeDestinacije(){let e,t;try{let o=await fetch(this.url+`/destinacije/${this.agencija.destinacije}/${this.destinacijaBrisanjeID}.json`,{method:"DELETE"});if(e=o.status,t=o.statusText,!o.ok)throw new Error;this.destinacije.splice(this.destinacijaBrisanjeIndex,1)}catch(o){console.log(o),t=`Firebase: ${e}\xA0${t}`;const l="Ooops";this.$router.push({path:"/error",state:e==200?{}:{title:l,message:t}})}},async uploadImage(){const e=new FormData;return e.append("file",this.slika[0]),e.append("UPLOADCARE_STORE","auto"),e.append("UPLOADCARE_PUB_KEY","5e5635739f48855b98f7"),`https://ucarecdn.com/${(await(await fetch("https://upload.uploadcare.com/base/",{method:"POST",body:e})).json()).file}/${this.slika[0].name}`},async newDestinacije(){let e,t;try{let o=await fetch(this.url+"/destinacije.json",{method:"POST",body:JSON.stringify({}),headers:{"Content-type":"application/json; charset=UTF-8"}});if(e=o.status,t=o.statusText,!o.ok)throw new Error;this.agencija.destinacije=(await o.json()).name}catch(o){console.log(o),t=`Firebase: ${e}\xA0${t}`;const l="Ooops";this.$router.push({path:"/error",state:e==200?{}:{title:l,message:t}})}},async submit(){let e,t;if(this.isFormValid){this.disabledBtn=!0,this.slika&&"size"in this.slika[0]&&(this.slikaURL=await this.uploadImage()),this.$route.params.id||await this.newDestinacije();let o={adresa:`${this.ulica}, ${this.grad}, ${this.postBroj}`,brojTelefona:this.telefon,destinacije:this.agencija.destinacije,email:this.email,godina:this.osnovana,logo:this.slikaURL,naziv:this.naziv};try{let l=await fetch(this.url+(this.$route.params.id?`/agencije/${this.agencija.id}.json`:"/agencije.json"),{method:this.$route.params.id?"PATCH":"POST",body:JSON.stringify(o),headers:{"Content-type":"application/json; charset=UTF-8"}});if(e=l.status,t=l.statusText,!l.ok)throw new Error;this.$route.params.id||(this.agencija.id=(await l.json()).name),this.okDialog=!0}catch(l){console.log(l),t=`Firebase: ${e}\xA0${t}`;const n="Ooops";this.$router.push({path:"/error",state:e==200?{}:{title:n,message:t}})}}},toTop(){window.scrollTo({top:0,behavior:"smooth"})},check(){this.fab=window.pageYOffset>60},async load_agencije(){let e,t;try{let o=await fetch(this.url+"/agencije.json");if(e=o.status,t=o.statusText,!o.ok)throw new Error;const l=await o.json();for(const n in l)if(n==this.$route.params.id){this.agencija={id:n,naziv:l[n].naziv,email:l[n].email,adresa:l[n].adresa,osnovana:l[n].godina,telefon:l[n].brojTelefona,destinacije:l[n].destinacije,slika:l[n].logo.split("/").pop(),slikaURL:l[n].logo},this.naziv=this.agencija.naziv,this.ulica=this.agencija.adresa.split(",")[0].trim(),this.grad=this.agencija.adresa.split(",")[1].trim(),this.postBroj=this.agencija.adresa.split(",")[2].trim(),this.email=this.agencija.email,this.telefon=this.agencija.telefon,this.osnovana=this.agencija.osnovana,this.slika=[{name:this.agencija.slika}],this.slikaURL=this.agencija.slikaURL;break}this.agencija.ulica=this.agencija.adresa.split(",")[0],this.load_destinacije(this.agencija.destinacije)}catch(o){console.log(o),t=`Firebase: ${e}\xA0${t}`;const l="Ooops";this.$router.push({path:"/error",state:e==200?{}:{title:l,message:t}})}},async load_destinacije(e){let t,o;try{let l=await fetch(this.url+"/destinacije.json");if(t=l.status,o=l.statusText,!l.ok)throw new Error;const n=await l.json(),u=[];console.log(n),console.log(e);for(const d in n[e])u.push({id:d,tip:n[e][d].tip,opis:n[e][d].opis,cena:n[e][d].cena,naziv:n[e][d].naziv,slike:n[e][d].slike,prevoz:n[e][d].prevoz,maxOsoba:n[e][d].maxOsoba});this.destinacije=u}catch(l){console.log(l),o=`Firebase: ${t}\xA0${o}`;const n="Ooops";this.$router.push({path:"/error",state:t==200?{}:{title:n,message:o}})}}},beforeMount(){this.$route.params.id&&this.load_agencije()}},F=e=>(J("data-v-6397ced8"),e=e(),K(),e),se=F(()=>g("div",{class:"text-h4 font-weight-bold mb-2"},"Podaci",-1)),ie=F(()=>g("div",{class:"text-h4 font-weight-bold mb-n0 mt-7"}," Destinacije: ",-1)),le={class:"float-left"},oe={class:"d-inline-block text-disabled text-right me-5 me-sm-12",style:{width:"29px","font-family":"monospace !important"}},ne={class:""};function re(e,t,o,l,n,u){const d=b("navigation"),V=b("router-link"),O=b("foote");return v((k(),z(x,null,{default:s(()=>[a(d,{color:"secondary",flat:!1}),a(R,null,{default:s(()=>[a(Q,{id:"content_holder_container"},{default:s(()=>[a(f,{id:"content_holder",class:"align-center text-center px-xs-3 px-sm-5 px-md-11"},{default:s(()=>[a(U,{"no-gutters":""},{default:s(()=>[a(r,{cols:"12",md:"6",class:"text-center order-md-last order-first pa-3 ps-3 ps-md-2 ps-lg-4"},{default:s(()=>[a(f,{class:"kartica",width:"100%",variant:"outlined"},{default:s(()=>[a(W,{"model-value":e.isFormValid,"onUpdate:modelValue":t[8]||(t[8]=i=>e.isFormValid=i),onSubmit:t[9]||(t[9]=q(i=>u.submit(),["prevent"])),validate:"blur",ref:"forma",autocomplete:"off"},{default:s(()=>[a(U,{class:"pa-13 pt-7 px-7 px-sm-9 px-md-11 px-lg-13"},{default:s(()=>[a(r,null,{default:s(()=>[se]),_:1}),a(r,{cols:"12"},{default:s(()=>[a(c,{rules:e.required,class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Naziv agencije",modelValue:e.naziv,"onUpdate:modelValue":t[0]||(t[0]=i=>e.naziv=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{cols:"12"},{default:s(()=>[a(c,{rules:e.required,class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Ulica i broj",modelValue:e.ulica,"onUpdate:modelValue":t[1]||(t[1]=i=>e.ulica=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{md:"7",cols:"12"},{default:s(()=>[a(c,{rules:e.required,class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Grad",modelValue:e.grad,"onUpdate:modelValue":t[2]||(t[2]=i=>e.grad=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{md:"5",cols:"12"},{default:s(()=>[a(c,{rules:[e.required,e.numeric].flat(),class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Po\u0161tanski broj",modelValue:e.postBroj,"onUpdate:modelValue":t[3]||(t[3]=i=>e.postBroj=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{cols:"12"},{default:s(()=>[a(c,{rules:[e.required,e.emailCheck].flat(),class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Email",modelValue:e.email,"onUpdate:modelValue":t[4]||(t[4]=i=>e.email=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{cols:"12"},{default:s(()=>[a(c,{rules:[e.required,e.numericPhone].flat(),class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Telefon",modelValue:e.telefon,"onUpdate:modelValue":t[5]||(t[5]=i=>e.telefon=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{md:"5",cols:"12"},{default:s(()=>[a(c,{rules:[e.required,e.numeric,e.numericYear].flat(),class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Godina osnivanja",modelValue:e.osnovana,"onUpdate:modelValue":t[6]||(t[6]=i=>e.osnovana=i)},null,8,["rules","modelValue"])]),_:1}),a(r,{md:"7",cols:"12"},{default:s(()=>[a(X,{rules:u.fileCheck,class:"mb-n4 text-left",variant:"outlined","bg-color":"#fff",label:"Slika",modelValue:e.slika,"onUpdate:modelValue":t[7]||(t[7]=i=>e.slika=i),accept:"image/*","prepend-icon":"","prepend-inner-icon":"mdi-paperclip"},null,8,["rules","modelValue"])]),_:1}),a(r,{md:"5",cols:"12","offset-md":"7"},{default:s(()=>[a(p,{type:"submit",class:"bg-white mt-4",style:{"font-weight":"600"},variant:"outlined",width:"100%",height:"44px",disabled:e.disabledBtn},{default:s(()=>[m(h(this.$route.params.id?"A\u017Euriraj":"Dodaj"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["model-value"])]),_:1})]),_:1}),a(r,{cols:"12",md:"6",class:"pe-0 pe-md-2 pe-lg-4"},{default:s(()=>[a(r,{cols:"12",class:"text-center"},{default:s(()=>[a(f,{class:"kartica",variant:"outlined"},{default:s(()=>[ie,a(ee,{class:"px-3 px-sm-6 py-13","bg-color":"#fffdf9",lines:"one"},{default:s(()=>[(k(!0),M(G,null,Y(e.destinacije,(i,j)=>(k(),z(T,{key:i.id},{default:s(({isHovering:A,props:E})=>[v(a(B,{thickness:"2"},null,512),[[D,j==0]]),a(ae,C(E,{style:{"background-color":A?"#f7f5f1":""}}),{title:s(()=>[g("div",le,[g("span",oe,h(j+1),1),g("span",ne,h(i.naziv),1)])]),append:s(()=>[a(V,{style:{"text-decoration":"none",color:"inherit"},to:`/admin_panel/destinacija/${e.agencija.destinacije}/${i.id}`},{default:s(()=>[a(p,{variant:"plain",icon:"mdi-pencil"})]),_:2},1032,["to"]),a(T,null,{default:s(({isHovering:S,props:_})=>[a(p,C({icon:"mdi-delete",variant:"plain"},_,{onClick:de=>{e.dialog=!0,e.destinacijaBrisanje=i.naziv,e.destinacijaBrisanjeID=i.id,e.destinacijaBrisanjeIndex=j},color:S?"red-darken-1":""}),null,16,["onClick","color"])]),_:2},1024)]),_:2},1040,["style"]),a(B,{thickness:"2"})]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),a(r,{cols:"12",class:"text-center"},{default:s(()=>[a(V,{style:H([this.$route.params.id?{}:{pointerEvents:"none",opacity:.5},{"text-decoration":"none",color:"inherit"}]),to:"/admin_panel/destinacija/"+e.agencija.destinacije},{default:s(()=>[a(p,{class:"mb-9 px-11 kartica mt-1",height:"50px",variant:"outlined",prependIcon:"mdi-plus"},{default:s(()=>[m(" dodaj novu destinaciju ")]),_:1})]),_:1},8,["style","to"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(I,null,{default:s(()=>[v(a(p,{fab:"",dark:"",fixed:"",bottom:"",right:"",class:"topFab",color:"#bfb7a7",icon:"mdi-arrow-up",onClick:u.toTop},null,8,["onClick"]),[[D,e.fab]])]),_:1}),a(O,{mediaLinks:!1}),a(y,{modelValue:e.dialog,"onUpdate:modelValue":t[12]||(t[12]=i=>e.dialog=i),width:"auto"},{default:s(()=>[a(f,{class:"kartica_dijalog pa-4"},{default:s(()=>[a(w,{class:"text-wrap text-center mb-4 mt-1"},{default:s(()=>[m(" Da li ste sigurni da \u017Eelite da obri\u0161ete destinaciju "+h(e.destinacijaBrisanje)+"? ",1)]),_:1}),a($,{class:"justify-center"},{default:s(()=>[a(p,{class:"me-2",style:{"border-radius":"13px"},variant:"text",onClick:t[10]||(t[10]=i=>{e.dialog=!1,u.brisanjeDestinacije()})},{default:s(()=>[m(" Da ")]),_:1}),a(p,{style:{"border-radius":"13px"},variant:"text",onClick:t[11]||(t[11]=i=>e.dialog=!1)},{default:s(()=>[m(" Ne ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(y,{modelValue:e.okDialog,"onUpdate:modelValue":t[14]||(t[14]=i=>e.okDialog=i),width:"auto",persistent:""},{default:s(()=>[a(f,{class:"kartica_dijalog pa-4"},{default:s(()=>[a(w,{class:"text-wrap text-center mb-4 mt-1"},{default:s(()=>[m(h(this.$route.params.id?`Uspe\u0161na izmena agencije ${e.naziv}!`:`Uspe\u0161no dodavanje agencije ${e.naziv}!`),1)]),_:1}),a($,{class:"justify-center"},{default:s(()=>[a(p,{style:{"border-radius":"13px"},variant:"text",onClick:t[13]||(t[13]=i=>{e.okDialog=!1,e.disabledBtn=!1,this.$route.params.id||this.$router.replace(`/admin_panel/agencija/${e.agencija.id}`)})},{default:s(()=>[m(" Ok ")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})),[[Z,u.check]])}const ve=L(te,[["render",re],["__scopeId","data-v-6397ced8"]]);export{ve as default};
